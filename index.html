<!DOCTYPE html>
<html>
<head>
  <title>The Vault Simulator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #log, #votingMatrixBox, #juryMatrixBox, #playerStatus, #alliancesBox { margin-top: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #aaa; padding: 5px; text-align: center; }
    .key-holder { font-weight: bold; color: green; }
    .eliminated { text-decoration: line-through; color: gray; }
    .collapsible { background-color: #eee; cursor: pointer; padding: 10px; width: 100%; text-align: left; border: none; outline: none; }
    .content { padding: 0 18px; display: none; overflow: hidden; }
    #gameArea { display: flex; justify-content: space-between; }
    #leftPanel { width: 70%; }
    #rightPanel { width: 28%; border-left: 2px solid #ccc; padding-left: 20px; }
  </style>
</head>
<body>

  <h1>The Vault Simulator</h1>
  <textarea id="playerInput" rows="12" cols="30" placeholder="Enter one player per line"></textarea><br>
  <button onclick="startGame()">Start Game</button>
  <button id="nextRoundBtn" onclick="nextRound()" style="display:none;">Next Round</button>
  
  <div id="gameArea">
    <div id="leftPanel">
      <div id="log"></div>
      <div id="votingMatrixBox"></div>
      <div id="juryMatrixBox"></div>
    </div>
    <div id="rightPanel">
      <div id="alliancesBox"></div>
      <div id="playerStatus"></div>
    </div>
  </div>

  <script>
    let players = [];
let round = 1;
let phase = 1;
let activePlayers = [];
let eliminatedPlayers = [];
let keyHolders = {};
let alliances = {};
let currentAllianceId = 1;
let votes = [];
let jury = [];
let lockpickHolder = null;
let lockpickAvailable = true;
let lockpickUsed = false;
let roundLog = '';
let duelQueue = [];
let voteMatrix = [];
let juryMatrix = [];
let finalVaultChoices = {};
let currentPhase3Step = 0;

function startGame() {
  const input = document.getElementById("playerInput").value.trim();
  if (!input) return;

  players = input.split('\n').map(name => name.trim()).filter(name => name);
  if (players.length !== 12) {
    alert("Enter exactly 12 players.");
    return;
  }

  initializeGame();
}

function initializeGame() {
  phase = 1;
  round = 1;
  activePlayers = [...players];
  eliminatedPlayers = [];
  keyHolders = {};
  votes = [];
  jury = [];
  lockpickHolder = null;
  lockpickAvailable = true;
  lockpickUsed = false;
  duelQueue = [];
  voteMatrix = [];
  juryMatrix = [];
  finalVaultChoices = {};
  currentPhase3Step = 0;

  players.forEach(p => keyHolders[p] = 0);
  generateRandomAlliances();
  updateUI();
  document.getElementById("nextRoundBtn").style.display = "inline-block";
  logEvent(`Game started with ${players.length} players.`);
}
function generateRandomAlliances() {
  alliances = {};
  const shuffled = [...players].sort(() => Math.random() - 0.5);
  const numAlliances = 3;
  for (let i = 0; i < numAlliances; i++) {
    alliances[`Alliance ${i + 1}`] = [];
  }

  shuffled.forEach((p, index) => {
    const aid = `Alliance ${index % numAlliances + 1}`;
    alliances[aid].push(p);
  });
}

function displayAlliances() {
  const box = document.getElementById("alliancesBox");
  box.innerHTML = `<h3>Alliances</h3>`;
  for (let a in alliances) {
    box.innerHTML += `<strong>${a}:</strong> ${alliances[a].join(', ')}<br>`;
  }
}

function updateUI() {
  displayAlliances();
  displayPlayerStatus();
  displayVotingMatrix();
  document.getElementById("log").innerHTML = roundLog;
}

function displayPlayerStatus() {
  const box = document.getElementById("playerStatus");
  let html = `<h3>Player Status</h3><table><tr><th>Player</th><th>Keys</th><th>Status</th></tr>`;
  players.forEach(p => {
    const status = eliminatedPlayers.includes(p) ? "Eliminated" : "Active";
    const className = eliminatedPlayers.includes(p) ? "eliminated" : keyHolders[p] > 0 ? "key-holder" : "";
    const keys = keyHolders[p] || 0;
    html += `<tr class="${className}"><td>${p}</td><td>${keys}</td><td>${status}</td></tr>`;
  });
  html += `</table>`;
  box.innerHTML = html;
}
    </script>

</body>
</html>